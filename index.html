<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Indigo demo</title>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="libindigo.js"></script>

<script>
function loadIndigo()
{
	return new Promise(function(resolve, reject)
	{

	  Module.onRuntimeInitialized = async _ => {
	    const api = {
	      version: Module.cwrap('indigoVersion', 'string', [])
	    };
	    return resolve(api.version());
	  };

	  Module.onAbort = async _ => {
		reject(Error('There was a network error.'));
	  };
	});
}


/*
function testFingerprints ()
{

   int mol = indigoLoadMoleculeFromString("C1C=CC=CC=1N(C)CO");
   int qmol = indigoLoadQueryMoleculeFromString("C1C=CC=CC=1N(C)CO");
   int fp = indigoFingerprint(mol, "sub-res");
   int qfp = indigoFingerprint(qmol, "sub-res");
   char *buf;
   int bufsize;

   printf("%s\n", indigoToString(fp));
   printf("%s\n", indigoToString(qfp));
   indigoToBuffer(fp, &buf, &bufsize);
   printf("size=%d\n", bufsize);
}
*/
</script>

    <script type="text/javascript">
      $( window ).on( "load", async function() {

	   var result = await loadIndigo();
           $("div.version").text(result);
           var m = 'c1ccccc1N';
           $("div.mol").text(m);
           var mol = Module.ccall('indigoLoadMoleculeFromString', 'number', ['string'], [m]);
           var w = Module.ccall('indigoMolecularWeight', 'number', ['number'], [mol]);
           $("div.mass").text(w);
           var molfile = Module.ccall('indigoMolfile', 'string', ['number'], [mol]);
           $("div.molfile").text(molfile);
//	   Module.ccall('indigoSetOption', null, ['string', 'string'], ['render-output-format', 'png']);
//	   Module.ccall('indigoRenderToFile', null, ['number', 'string'], [mol,'query1.png']);

	//testFingerprints 
           const indigo = {
	      LoadMolecule: Module.cwrap('indigoLoadMoleculeFromString', 'number', ['string']),
	      LoadQueryMolecule: Module.cwrap('indigoLoadQueryMoleculeFromString', 'number', ['string']),
              Fingerprint: Module.cwrap('indigoLoadQueryMoleculeFromString', 'number', ['number','string']),
              Molfile: Module.cwrap('indigoMolfile','string', ['number']),
	      ToString:	Module.cwrap('indigoToString','string', ['number'])
	    };

	var mol = indigo.LoadMolecule("C1C=CC=CC=1N(C)CO");
	var qmol = indigo.LoadQueryMolecule("C1C=CC=CC=1N(C)CO");
	var fp = indigo.Fingerprint([mol, "sub-res"]);
	var qfp = indigo.Fingerprint([qmol, "sub-res"]);
        $("div.t1").text(indigo.ToString(fp));
        $("div.t2").text(indigo.ToString(qfp));


      });
    </script>
  </head>

  <body>
    <h1>Indigo example</h1>
    <h2>Version</h2>
    <div class="version"></div>
    <h2>Molecule</h2>
    <div class="mol"></div>
    <h2>Molecule mass</h2>
    <div class="mass"></div>
    <h2>Molecule file</h2>
    <div class="molfile"></div>
    <h2>TestFingerprints</h2>
    <div class="t1"></div>
    <div class="t2"></div>
  </body>
</html>
